"use strict";!function(e){e(document).ready(function(){function t(){return{getConfiguration:function(){},init:function(){},render:function(e){console.log("render options: ",e);var t=e.results.hits,a=t.map(function(e){return{title:e.title,logo:e.logo,lat:e.lat,lng:e.lng,country:e.country,city:e.city,address:e.address}});console.log(a),a.forEach(function(e){var t={icon:L.mapbox.marker.icon({"marker-size":"large","marker-symbol":"star","marker-color":"#ff0000"})},a='\n            <div>\n              <div style="text-align:center;">\n                <img src="'+e.logo+'" style="width:80px;"/>\n              </div>\n              <div><b>'+e.title+"</b></div>\n            </div>",i=function(e,i){L.marker([i.latlng[0],i.latlng[1]],t).bindPopup(a).addTo(n)};if(e.lat&&e.lng)r.reverseQuery([e.lat,e.lng],function(e,t){if(e)throw e;i(e,t)});else{if(!e.city&&!e.country)return;var s=[e.address,e.city,e.country].join(", ");r.query(s,function(e,t){if(e)throw e;console.log("mapbox data",t),i(e,t)})}})}}}function a(){return{getConfiguration:function(){},init:function(){},render:function(e){console.log("tableWidget render options: ",e);var t=e.results.hits;d.rows().remove(),d.rows.add(t).draw()}}}var i="pk.eyJ1IjoiY3ViZTUiLCJhIjoiY2l2eDltdXRxMDFmczJ1cGRrcTN3M3NiNSJ9.MPdk_yTt0MwRQsll8CnSeg";L.mapbox.accessToken=i;var n=L.mapbox.map("map-container","mapbox.streets").setView([0,0],1),r=L.mapbox.geocoder("mapbox.places"),s="ITI5JHZJM9",l="5828bf68d90dbb0251e6ce88aabe2e07",o="diybiosphere",c=instantsearch({appId:s,apiKey:l,indexName:o,urlSync:!0});c.addWidget(instantsearch.widgets.searchBox({container:"#search-box",placeholder:"Search for an entry",cssClasses:{root:"ui icon left input fluid"}})),c.addWidget(instantsearch.widgets.currentRefinedValues({container:"#current-refined-values",autoHideContainer:!0,cssClasses:{root:"ui medium labels"},templates:{item:'\n\t\t\t\t\t<a class="ui grey label">\n\t\t\t\t\t  {{name}}\n\t\t\t\t\t  <i class="delete icon"></i>\n\t\t\t\t\t</a>'}})),c.addWidget(instantsearch.widgets.stats({container:"#stats-container",templates:{body:' <h3 class="ui header">{{nbHits}} matching entries</h3>'}})),c.addWidget(instantsearch.widgets.refinementList({container:"#collection",attributeName:"collection",operator:"or",limit:10,cssClasses:{root:"ui secondary inverted vertical menu",item:"link item",active:"active item"},templates:{header:'<h4 class="ui inverted header">Collection</h4>',item:"\n\t\t\t\t\t\t  {{name}} - {{count}}\n\t\t\t\t\t\t"}})),c.addWidget(instantsearch.widgets.refinementList({container:"#type-org",attributeName:"type-org",operator:"or",limit:10,cssClasses:{root:"ui secondary inverted vertical menu",item:"link item",active:"active item"},templates:{header:'<h4 class="ui inverted header">Type of Initiative</h4>',item:"\n\t\t\t\t\t\t{{name}} - {{count}}\n\t\t\t\t\t"}})),c.addWidget(instantsearch.widgets.refinementList({container:"#tags",attributeName:"tags",operator:"or",limit:10,searchForFacetValues:{placeholder:"Search for keywords"},cssClasses:{root:"ui labels",item:"ui label xo paddingfull half",active:"ui grey label xo paddingfull half"},templates:{header:'<h4 class="ui inverted header">Keywords</h4>',item:"{{name}} - {{count}}"}})),c.addWidget(instantsearch.widgets.pagination({container:"#pagination-container",labels:{previous:'<i class="fa fa-angle-left"></i>',next:'<i class="fa fa-angle-right"></i>',first:'<i class="fa fa-double-angle-left"></i>',last:'<i class="fa fa-double-angle-right"></i>'},padding:1,cssClasses:{root:"ui horizontal link list no-bullets",item:"item",active:"active item",disabled:"disabled item"}})),c.addWidget(instantsearch.widgets.hitsPerPageSelector({container:"#hits-per-page-selector",cssClasses:{root:"ui inline dropdown"},options:[{value:5,label:"5 per page"},{value:10,label:"10 per page"},{value:25,label:"25 per page"},{value:50,label:"50 per page"},{value:100,label:"100 per page"}]})),c.addWidget(t()),c.addWidget(a()),c.start();var d=e("#library-table").DataTable({paging:!1,ordering:!0,dom:'<"top"i<"pull-right"B>>rt<"bottom"ip<"clear">>',buttons:[{extend:"csvHtml5",text:'<i class="fa fa-download"></i> Download as CSV',titleAttr:"CSV",className:"link selectable text-dark"}],columnDefs:[{visible:!0,targets:0,name:"collection",data:"collection"},{visible:!0,targets:1,name:"title",data:"title",render:function(e,t,a){return'<a class="link selectable" href="'+a.url+'">'+e+"</a>"}},{visible:!0,targets:2,name:"title",data:"title"},{visible:!0,targets:3,name:"host-org",data:"host-org",render:function(e){var t="",a="",i="";return null!==e?(t=e.name||"",null!==e.web&&(a='\n                  <a class="link selectable" href="'+e.web+'">\n                    <i class="fa fa-link"></i>\n                  </a>\n                '),null!==e.sphere&&(i='\n                  <a class="link selectable" href="'+e.sphere+'">\n                    <i class="fa fa-external-link"></i>\n                  </a>\n                '),t+" "+a+" "+i):""}},{visible:!0,targets:4,name:"type-org",data:"type-org"},{visible:!0,targets:5,name:"city",data:"city"},{visible:!0,targets:6,name:"country",data:"country"},{visible:!0,targets:7,name:"lastest-commit",data:"last_modified"},{visible:!0,targets:8,name:"tags",data:"tags",render:function(e){return""+e.join(",")}}],language:{thousands:",",zeroRecords:"Nothing found - sorry",info:"Showing _TOTAL_ entries",infoEmpty:"Showing _TOTAL_ entries",infoFiltered:"from _MAX_ total"}});e("#entries tfoot td").each(function(){var t=e(this),a=t.text(),i=a.toLowerCase();t.html('<input id="'+i+'" type="text" placeholder="Search '+a+'" />')}),d.columns().every(function(){var t=this;e("input",this.footer()).on("keyup change",function(){t.search()!==this.value&&t.search(this.value).draw()})})})}($);